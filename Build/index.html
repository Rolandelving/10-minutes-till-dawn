<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Minutes Till Dawn</title>
    <link rel="shortcut icon" href="TemplateData/favicon.ico">
    
    <!-- Load UnityLoader from CDN -->
    <script src="https://cdn.jsdelivr.net/gh/Rolandelving/10-minutes-till-dawn@main/Build/UnityLoader.js"></script>
    
    <script>
      var gameInstance;
      var scaleToFit = true;

      // Initialize the Unity game
      function initializeGame() {
        try {
          gameInstance = UnityLoader.instantiate("gameContainer", "Build/10MinutesTillDawnWebGL.json");
        } catch (error) {
          console.error("Failed to load Unity game:", error);
          document.getElementById("gameContainer").innerHTML = '<div style="color: white; text-align: center; padding: 50px; font-family: Arial;">Failed to load Unity game. Please check console for details.</div>';
        }
      }

      function onResize() {
        if (!gameInstance || !gameInstance.Module || !gameInstance.Module.canvas) {
          return;
        }

        var canvas = gameInstance.Module.canvas;
        var container = gameInstance.container;
        var w, h;

        if (scaleToFit) {
          w = window.innerWidth;
          h = window.innerHeight;

          // Use aspect ratio from your JSON (assuming 16:10 based on common Unity defaults)
          var aspectRatio = 10 / 16; // height / width

          if (w * aspectRatio > window.innerHeight) {
            w = Math.min(w, Math.ceil(h / aspectRatio));
          }
          h = Math.floor(w * aspectRatio);
        } else {
          w = 1280; // Default width
          h = 800;  // Default height
        }

        container.style.width = canvas.style.width = w + "px";
        container.style.height = canvas.style.height = h + "px";
        container.style.top = Math.floor((window.innerHeight - h) / 2) + "px";
        container.style.left = Math.floor((window.innerWidth - w) / 2) + "px";
      }

      // Add event listeners when page loads
      window.addEventListener("load", function() {
        initializeGame();
        onResize();
      });
      
      window.addEventListener("resize", onResize);
    </script>

    <style>
      html,
      body {
        background: #231F20;
        width: 100%;
        height: 100%;
        overflow: hidden;
        padding: 0;
        margin: 0;
        font-family: Arial, sans-serif;
      }

      div#gameContainer {
        background: transparent !important;
        position: absolute;
      }

      div#gameContainer canvas {
        position: absolute;
        background: #231F20;
      }

      div#gameContainer[data-pixelated="true"] canvas {
        image-rendering: optimizeSpeed;
        image-rendering: -webkit-crisp-edges;
        image-rendering: -moz-crisp-edges;
        image-rendering: -o-crisp-edges;
        image-rendering: crisp-edges;
        image-rendering: -webkit-optimize-contrast;
        image-rendering: optimize-contrast;
        image-rendering: pixelated;
        -ms-interpolation-mode: nearest-neighbor;
      }

      /* Loading indicator */
      .loading {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 18px;
        z-index: 1000;
      }

      .loading::after {
        content: '';
        animation: dots 1.5s steps(5, end) infinite;
      }

      @keyframes dots {
        0%, 20% {
          color: rgba(0,0,0,0);
          text-shadow:
            .25em 0 0 rgba(255,255,255,0),
            .5em 0 0 rgba(255,255,255,0);
        }
        40% {
          color: white;
          text-shadow:
            .25em 0 0 rgba(255,255,255,0),
            .5em 0 0 rgba(255,255,255,0);
        }
        60% {
          text-shadow:
            .25em 0 0 white,
            .5em 0 0 rgba(255,255,255,0);
        }
        80%, 100% {
          text-shadow:
            .25em 0 0 white,
            .5em 0 0 white;
        }
      }
    </style>
</head>

<body>
    <div id="gameContainer" data-pixelated="true">
        <div class="loading">Loading Unity Game</div>
    </div>
    
    <script>
      // Prevent right-click context menu
      document.addEventListener('contextmenu', function(e) {
        e.preventDefault();
      });

      // Handle fullscreen
      document.addEventListener('keydown', function(e) {
        if (e.key === 'F11') {
          e.preventDefault();
          var container = document.getElementById('gameContainer');
          if (!document.fullscreenElement) {
            if (container.requestFullscreen) {
              container.requestFullscreen();
            }
          } else {
            if (document.exitFullscreen) {
              document.exitFullscreen();
            }
          }
        }
      });

      document.addEventListener('fullscreenchange', function() {
        setTimeout(onResize, 100);
      });
    </script>
</body>
</html>
